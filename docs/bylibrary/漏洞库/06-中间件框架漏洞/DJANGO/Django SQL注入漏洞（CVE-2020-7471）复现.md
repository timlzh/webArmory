## Django SQL注入漏洞（CVE-2020-7471）复现

# **简介**

Django  官方发布安全通告公布了一个通过StringAgg（分隔符）实现利用的潜在SQL注入漏洞（CVE-2020-7471）。攻击者可通过构造分隔符传递给聚合函数contrib.postgres.aggregates.StringAgg，从而绕过转义并注入恶意SQL语句。

# 影响版本

```
Django 1.11.x < 1.11.28
Django 2.2.x < 2.2.10
Django 3.0.x < 3.0.3
Django 主开发分支
```

# **环境搭建**

安装Django（v3.0.2）

pip3 install django==3.0.2 -i https://pypi.tuna.tsinghua.edu.cn/simple

![1](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\1.jpg)

安装postgres

apt-get install postgresql-11

![2](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\2.jpg)

开启服务并登录账号postgres

密码为空

![3](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\3.jpg)

给数据库超级用户postgres添加密码123456

然后创建数据库

![4](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\4.jpg)

![5](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\5.jpg)

Poc地址： https://github.com/Saferman/CVE-2020-7471.git

![6](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\6.jpg)

修改 sqlvul_projects/settings.py

修改相关配置信息，我这里修改了密码其他一样即可

![7](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\7.jpg)

接下来就是利用manage.py进行初始化和配置了

初始化数据表(django)

python3 manage.py migrate

![8](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\8.jpg)

python3 manage.py makemigrations vul_app

python3 manage.py migrate vul_app

![9](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\9.jpg)

依次执行命令查看vul_app_info里是否有内容

```
sudo -i -u postgres

psql

\c test

\d

select * from vul_app_info;
```

![10](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\10.jpg)

没有

![11](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\11.jpg)

漏洞复现

运行 POC 脚本（CVE-2020-7471.py）查看结果

![12](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\12.jpg)

回到数据库中，发现存在内容了，成功

![13](C:\Users\litbaizhang\Desktop\20201222\DJANGO\DJANGO SQL注入漏洞CVE-2020-7471\13.jpg)

# **修复建议**

升级到最新版