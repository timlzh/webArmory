# Dedecms前台文件上传漏洞CVE-2018-20129

## 影响版本

dedecmsV5.7 SP2

## 漏洞成因

管理员用户前台可以绕过限制上传shell

## 复现

登录并进入 `member/article\_add.php` 发布文章，选择下面的富文本编辑器插入图片 ![](Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/af04d86a30794181263cad493b759731.png) 选

择好 shell 并上传抓包

 ![](Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/189e02e32f8fc9c11570e03236594d1a.png) 

![](Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/e3fef918b39b14960583f1d4e0fcb8c0.png) 

向如上分析修改文件名与content-type，即可返回 shell 地址 ![](Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/3c7c9ec6b57528d6d3171b7153b5445b.png)

## 修复意见

在最后拼接文件名时再判断一次。